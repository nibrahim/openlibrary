$def with (summary, total, cases, desc, current_user, error = False)

<div id="contentHead">
    $:render_template("admin/menu")
    <h1>Help Cases</h1>
</div>
<div id="contentBody">
<style type="text/css">
#content ul#caselist { 
                       list-style-type: none;
                       }

</style>

$def get_unread_status(case, user):
   $if len(case.history) > case.message_count.get(user.get_email(), 0):
      modified
   

$def get_modification_class(entry, user):
  $if entry.by == user.get_email():
      self
  $if entry.by == case.creator_email:
      creator
  other

$def get_age_class(case):  
  $if case.age > 5:
      old

$ path = request.path
$if path.endswith("support"): 
   $ path = "/admin/support/new"


$def link(url, title, extra):
    $if url.endswith(path):
        <strong>$title ($extra)</strong>
    $else:
        <a href="$url">$title $extra</a>

$if error:
  <p>Couldn't connect to support database.</p>
$else:
  <p>
    Filter: $:link("/admin/support/new", "new", summary["new"])  |
    $:link("/admin/support/replied", "replied", summary["replied"]) |
    $:link("/admin/support/closed", "closed", summary["closed"]) |
    $:link("/admin/support/all", "all", total) 
  </p>

  <ul class="caselist">
    $for case in cases:
    <li class="$get_unread_status(case, current_user) $get_modification_class(case.history[-1], current_user) $get_age_class(case)">$:render_template("admin/case-summary", case, current_user)</li>
  </ul>
</div>
