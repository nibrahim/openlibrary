$def with (case, admins)

$var title: $case.subject ($case.creator_username)


<style type="text/css">

span.status  { 
               display: inline;
               width: 10%;
               float: right;
               font-size: 12pt;
               color: white;
               text-align: center;
               padding: 0.2em;
               }

span.status-replied, span.status-new {
                                        background-color: green;
                                       }

span.status-closed {
                     background-color: #BD2C00;
}

#assignee { 
            display: inline;
 }

div.description{ 
                 padding-left: 20px; 
                 background-color: #f5f5f5;
 }

#close2 {
          float: right; 
          margin: 0;
          }

table.info th { 
                font-weight: bold;
                padding: 1pt 5pt;
                
 }

ul.casehistory h6 { 
                    font-weight: normal;
 }
ul.casehistory h6 span.date { 
                              float: right;
 }


ul.casehistory h6 span.user { 
                              font-weight: bold;
 }

#content ul.casehistory { 
                          margin: 0;
 }
#content ul.casehistory li { 
                             list-style-type: none;
                             background-color: #fafafa;
                             border: 2px solid #eee;
                             margin:5pt ;
                             padding: 0;
 }


#content ul.casehistory li h6 { 
                                border-bottom: 1px solid #aaa;
                                margin: 0;
                                background-color: #ccc;
                                padding: 0 3pt;
 }

#content ul.casehistory li p { 
                               margin: 5pt;

 }

</style>

$def get_summary(entry):
   $if hasattr(entry, "summary"):
      $:entry.summary


<div id="contentHead">
    $:render_template("admin/menu", "/admin")
</div>

<div id="contentBody">

<h1><a href="/admin/support">Cases</a> / $case.caseno: $case.subject 
<span class="status status-$case.status">
  $case.status
</span>
</h1>                            
$if case.status != "closed":
   <form method="POST">
     <input type="submit" name="button" id="close2" value="CLOSE CASE" />
   </form>
$else:
   <form method="POST">
     <input type="submit" name="button" id="close2" value="OPEN CASE" />
   </form>

By
$if (case.creator_name):
    <a href="/admin/people/$(case.creator_email)">$(case.creator_name)</a> 
$else:
    <a href="/admin/people/$(case.creator_email)">$(case.creator_email)</a>

| Assigned to 
<form method="POST" id="assignee">
    <select name="assignee" id="assignee" onChange="\$('#assignee').submit();">
      $for email,username,selected in admins:
        $if selected:
	  <option selected="selected" value="$:email">$username</option>
        $else:
	  <option value="$:email">$username</option>
    </select>
    <input type="hidden" name="button" value="REASSIGN"/>
</form>

<div class="description" >
  <span class="largest">$:format(case.description)</span>
</div>

<table class="info">
<tr>
  <th>Browser</th><td><span class="smaller">$(case.creator_useragent)</span><br/></td>
</tr>
<tr>
  <th>Assigned to</th><td>$case.assignee</td>
</tr>
</table>

<ul class="casehistory">
  $for entry in case.history:
    <li class="casenote">
	<h6><span class="user">$(entry.by)</span> $get_summary(entry) <span class="date">$(datestr(entry.at))</span></h6>
	$if entry.text:
	 <p>
	    $:format(entry.text)
	 </p>
    </li>
</ul>

<h2>Update case</h2>
<form method="POST">
  Reassign case to : 
  <select name="assignee" id="assignee">
    $for email,username,selected in admins:
        $if selected:
          <option selected="selected" value="$:email">$username</option>
        $else:
          <option value="$:email">$username</option>
  </select>
  <input type="hidden" name="button" value="REASSIGN"/>

  <h3>Add casenote</h3>

  <p>
    <textarea class="markdown" name="casenote" id="textarea" rows="10" style="width: 90%"></textarea>
  </p>
  <p>
    <input type="checkbox" name="copycreator" id="copycreator" value="copy"/> <label for="copycreator">Send a copy of the message to </label>
    <input name="email" type="text" id="email" value="$(case.creator_email)" size="35" />
  </p>
  <p>
    <input type="checkbox" name="closecase" id="closecase"/> <label for="closecase">Close case after updating</label>
  </p>
  <p><input type="submit" name="button" id="button3" value="UPDATE CASE" /></p>	
</form>
